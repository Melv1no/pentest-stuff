import argparse
import ipaddress
import os
import sys


parser = argparse.ArgumentParser(description="Script d'automatisation des scans nmap.")
parser.add_argument('ip',type=str,help='Adresse ip de la cible.')

def validate_ip_address(address):
    try:
        ip = ipaddress.ip_address(address)
        print("[+] IP address {} is valid".format(address))
    except ValueError:
        print("[-] IP address {} is not valid".format(address) + ", FQND ?")
        #sys.exit()

def start():
    args = parser.parse_args()
    validate_ip_address(args.ip)
    nmap_scan(args.ip)

def nmap_scan(ip):
    os.mkdir("{}".format(ip))

    os.system("nmap -A {} >> {}/{}-nmap-A.txt".format(ip,ip,ip))
    print("[+] nmap -A")

    os.system("nmap -sV -sC {} >> {}/{}-nmap-sV-sC.txt".format(ip,ip,ip))
    print("[+] nmap -sV -sC")

    os.system("nmap --script=vuln {} >> {}/{}-nmap-vuln.txt".format(ip,ip,ip))
    print("[+] nmap --script=vuln")

    # OTHER SCAN HERE...

    print("All scan finished, redirect you to directory logs")
    os.system("cd {}".format(ip))

if __name__ == '__main__':
    start()
